<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Move Parser Test - Disambiguation Fix</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .test-case {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .failure {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      .test-result {
        margin-top: 10px;
        font-weight: bold;
      }
      .move-sequence {
        font-family: monospace;
        background-color: #f8f9fa;
        padding: 5px;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <h1>Move Parser Test - Disambiguation Fix</h1>
    <p>
      Testing the fix for the failure case:
      <span class="move-sequence"
        >1. Nf3 g6 2. g3 Bg7 3. Bg2 Nf6 4. d4 O-O 5. Nbd2 d5</span
      >
    </p>

    <div id="test-results"></div>

    <script type="module">
      import { parseSimpleMove } from "../src/utils/move-parser.js";

      const testResults = document.getElementById("test-results");

      // Test the specific failure case
      const testCases = [
        {
          name: "Nbd2 disambiguation test",
          fen: "rnbqkb1r/pppppppp/5n2/8/3P4/8/PPP1PPPP/RNBQKBNR w KQkq - 0 1",
          move: "Nbd2",
          expected: "b1", // Should find the knight on b1
        },
        {
          name: "Nf3 basic knight move",
          fen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
          move: "Nf3",
          expected: "g1", // Should find the knight on g1
        },
        {
          name: "Nc3 basic knight move",
          fen: "rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",
          move: "Nc3",
          expected: "b1", // Should find the knight on b1
        },
      ];

      function runTest(testCase) {
        const result = parseSimpleMove(testCase.move, testCase.fen);

        const div = document.createElement("div");
        div.className = `test-case ${result && result.from === testCase.expected ? "success" : "failure"}`;

        const status =
          result && result.from === testCase.expected ? "✅ PASS" : "❌ FAIL";
        const details = result
          ? `Parsed: ${result.from} → ${result.to} (${result.piece})`
          : "Failed to parse move";

        div.innerHTML = `
                <h3>${testCase.name}</h3>
                <p><strong>Move:</strong> ${testCase.move}</p>
                <p><strong>FEN:</strong> ${testCase.fen.substring(0, 50)}...</p>
                <p><strong>Expected from square:</strong> ${testCase.expected}</p>
                <div class="test-result">${status}</div>
                <p><strong>Result:</strong> ${details}</p>
            `;

        testResults.appendChild(div);
      }

      // Run all tests
      testCases.forEach(runTest);

      console.log("Move parser disambiguation tests completed");
    </script>
  </body>
</html>
