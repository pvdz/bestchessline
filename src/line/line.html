<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Best Chess Line Discovery - by Peter van der Zee, July 2025</title>
    <link rel="stylesheet" href="/src/line/styles.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  </head>
  <body>
    <div class="container">
      <h1>Best Chess Line Discovery</h1>
      <small>
        A simple tool to discover the next best move using Stockfish (v16). You
        can select how many lines Stockfish should report, which may be
        different for the current player (only the best move for white but best
        5 responses for black, etc.). Peter van der Zee, &copy;
        <a href="https://pvdz.ee" target="_blank">pvdz.ee</a> , July 2025.
      </small>

      <div class="main-content">
        <!-- Fish -->
        <div id="fish-section">
          <h2>Line Fisher</h2>
          <div id="fish-controls">
            <div id="fish-buttons">
              <button id="fish-start">Fish2</button>
              <button id="fish-stop" disabled>Stop</button>
              <button id="fish-reset">Reset</button>
              <button id="fish-copy">Copy</button>
              <button id="fish-export">Export</button>
              <button id="fish-import">Import</button>
              <button id="fish-continue">Continue</button>
                <button id="fish-preset-quick" title="Set responder=2, overrides empty, depth=4">Preset 2/4</button>
              <div class="thread-controls">
                <label for="fish-threads">Threads:</label>
                <input
                  type="range"
                  id="fish-threads"
                  min="1"
                  max="16"
                  value="10"
                />
                <span id="fish-threads-value">10</span>
              </div>
              <div class="fish-preview-toggle">
                <label for="fish-lines-toggle">
                  <input type="checkbox" id="fish-lines-toggle" checked />
                  <span>Display last line updates</span>
                </label>
              </div>
            </div>
            <div id="fish-initiator-controls">
              <div class="initiator-moves-controls">
                <label for="fish-initiator-moves">Initiator Moves:</label>
                <input
                  type="text"
                  id="fish-initiator-moves"
                  placeholder="e.g., Nf3 g3"
                  value="Nf3 g3"
                />
              </div>
              <div class="responder-counts-controls">
                <label for="fish-responder-counts">Responder Counts:</label>
                <input
                  type="text"
                  id="fish-responder-counts"
                  placeholder="2 3 2"
                  value="2 3"
                  title="Space-separated responder move counts for each level"
                />
              </div>

              <div class="responder-moves-controls">
                <label for="fish-default-responder-count"
                  >Default Responder Count:</label
                >
                <input
                  type="range"
                  id="fish-default-responder-count"
                  min="1"
                  max="15"
                  value="3"
                  class="fish-slider"
                  title="Default responder count for levels not specified"
                />
                <span id="fish-default-responder-count-value">3</span>
              </div>
              <div class="depth-controls">
                <label for="fish-depth">Move Depth:</label>
                <input
                  type="range"
                  id="fish-depth"
                  min="1"
                  max="10"
                  value="1"
                  class="fish-slider"
                />
                <span id="fish-depth-value">1</span>
              </div>
            </div>
          </div>
          <div id="fish-status">Ready</div>
          <div class="pv-ticker" id="fish-pv-ticker"></div>

          <div id="fish-config-root" class="fish-panel">
            <h3>Configuration</h3>
            <div id="fish-config-board-root">
              <div id="fish-board-display"></div>
              <div id="fish-config-details">
                <div class="fish-config-item">
                  <label>Initiator Moves:</label>
                  <span id="fish-config-initiator-moves">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Responder Counts:</label>
                  <span id="fish-config-responder-counts">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Move Depth:</label>
                  <span id="fish-config-move-depth">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Threads:</label>
                  <span id="fish-config-threads">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Total nodes:</label>
                  <span id="fish-config-total-nodes">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Total lines:</label>
                  <span id="fish-config-total-lines">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Node formula:</label>
                  <span id="fish-config-node-formula">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Line formula:</label>
                  <span id="fish-config-line-formula">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Leaf nodes:</label>
                  <span id="fish-config-leaf-nodes">-</span>
                </div>
                <div class="fish-config-item">
                  <label>Root score:</label>
                  <span id="fish-config-root-score">-</span>
                </div>
              </div>
            </div>
          </div>

          <div id="fish-state-info" class="fish-panel">
            <h3 id="fish-status-title">Analysis Status</h3>
            <div class="fish-progress-section">
              <div id="fish-status-progress-bar">
                <div id="fish-status-progress-fill-total"></div>
                <div id="fish-status-progress-fill"></div>
              </div>
              <div id="fish-status-progress-stats">
                <span class="fish-progress-item"
                  >Lines:
                  <span id="fish-status-lines"></span>
                </span>
                <span class="fish-progress-item"
                  >Wips:
                  <span id="fish-status-wips"></span>
                </span>
                <span class="fish-progress-item"
                  >Dones:
                  <span id="fish-status-dones"></span>
                </span>
                <span class="fish-progress-item"
                  >Position:
                  <span id="fish-status-position"></span>
                </span>
              </div>
            </div>
          </div>
          <div id="fish-lines-panel" class="fish-panel" style="display: none">
            <h3>Live Lines</h3>
            <div id="fish-lines-content">
              <div class="fish-lines-column">
                <h4>WIP</h4>
                <div id="fish-lines-wip"></div>
              </div>
              <div class="fish-lines-column">
                <h4>Done</h4>
                <div id="fish-lines-done"></div>
              </div>
            </div>
          </div>
          <div id="fish-results" class="fish-panel"></div>
        </div>

        <!-- Chess Board -->
        <div class="board-section">
          <div class="board-header">
            <h2>Chess Board</h2>
            <button
              id="position-evaluation-btn"
              class="evaluation-button"
              title="Click to get Stockfish evaluation of current position"
            >
              ??
            </button>
          </div>
          <div id="chess-board"></div>
          <div class="current-player-control">
            <label>Current Player:</label>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="current-player" value="w" checked />
                <span>White</span>
              </label>
              <label class="radio-label">
                <input type="radio" name="current-player" value="b" />
                <span>Black</span>
              </label>
            </div>
          </div>

          <div class="board-controls">
            <button id="reset-board">Reset</button>
            <button id="clear-board">Clear</button>
            <div class="fen-input">
              <input
                type="text"
                id="fen-input"
                placeholder="Enter FEN position..."
                value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"
              />
              <button id="load-fen">Load FEN</button>
            </div>

            <div class="game-import">
              <textarea
                id="game-notation"
                placeholder="Enter game notation (e.g., 1. e4 e5 2. Nf3 Nc6 3. Bb5 a6)"
              >
1. Ng1f3
1. Ng1f3  Pd7d5 2. Pd2d4
1. Ng1f3  Ng8f6 2. Pd2d4
1. Ng1f3  Pd7d5 2. Pd2d4  Pe7e6 3. Pc2c4
1. Ng1f3  Pd7d5 2. Pd2d4  Ng8f6 3. Pc2c4
1. Ng1f3  Pd7d5 2. Pd2d4  Bc8f5 3. Pc2c4
1. Ng1f3  Ng8f6 2. Pd2d4  Pd7d5 3. Pc2c4
1. Ng1f3  Ng8f6 2. Pd2d4  Pc7c6 3. Bc1f4
1. Ng1f3  Ng8f6 2. Pd2d4  Pe7e6 3. Pc2c4
1. Ng1f3  Pd7d5 2. Pd2d4  Pe7e6 3. Pc2c4  Ng8f6 4. Nb1c3
1. Ng1f3  Pd7d5 2. Pd2d4  Pe7e6 3. Pc2c4  Bf8b4 4. Bc1d2
1. Ng1f3  Pd7d5 2. Pd2d4  Pe7e6 3. Pc2c4  Pa7a6 4. Pc4d5
1. Ng1f3  Pd7d5 2. Pd2d4  Ng8f6 3. Pc2c4  Pc7c6 4. Nb1c3
1. Ng1f3  Pd7d5 2. Pd2d4  Ng8f6 3. Pc2c4  Pc7c5 4. Pc4d5
1. Ng1f3  Pd7d5 2. Pd2d4  Ng8f6 3. Pc2c4  Pe7e6 4. Nb1c3
1. Ng1f3  Pd7d5 2. Pd2d4  Bc8f5 3. Pc2c4  Pd5c4 4. Pe2e3
1. Ng1f3  Pd7d5 2. Pd2d4  Bc8f5 3. Pc2c4  Pc7c6 4. Pc4d5
1. Ng1f3  Pd7d5 2. Pd2d4  Bc8f5 3. Pc2c4  Pe7e6 4. Nb1c3
1. Ng1f3  Ng8f6 2. Pd2d4  Pd7d5 3. Pc2c4  Pc7c5 4. Pc4d5
1. Ng1f3  Ng8f6 2. Pd2d4  Pd7d5 3. Pc2c4  Pc7c6 4. Pe2e3
1. Ng1f3  Ng8f6 2. Pd2d4  Pd7d5 3. Pc2c4  Pe7e6 4. Nb1c3
1. Ng1f3  Ng8f6 2. Pd2d4  Pc7c6 3. Bc1f4  Pd7d5 4. Pe2e3
1. Ng1f3  Ng8f6 2. Pd2d4  Pc7c6 3. Bc1f4  Pd7d6 4. Pc2c4
1. Ng1f3  Ng8f6 2. Pd2d4  Pc7c6 3. Bc1f4  Qd8b6 4. Qd1c1
1. Ng1f3  Ng8f6 2. Pd2d4  Pe7e6 3. Pc2c4  Bf8e7 4. Nb1c3
1. Ng1f3  Ng8f6 2. Pd2d4  Pe7e6 3. Pc2c4  Pd7d5 4. Nb1c3
1. Ng1f3  Ng8f6 2. Pd2d4  Pe7e6 3. Pc2c4  Bf8b4 4. Bc1d2
                        </textarea
              >
              <button id="import-game">Import Game</button>
            </div>
          </div>

          <div class="position-controls">
            <div class="control-row">
              <div class="control-group castling">
                <label>White Castling:</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="white-kingside" checked />
                    <span>Kingside (K)</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="white-queenside" checked />
                    <span>Queenside (Q)</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="control-row">
              <div class="control-group castling">
                <label>Black Castling:</label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" id="black-kingside" checked />
                    <span>Kingside (k)</span>
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" id="black-queenside" checked />
                    <span>Queenside (q)</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="control-row">
              <div class="control-group en-passant">
                <label for="en-passant">En Passant:</label>
                <input
                  type="text"
                  id="en-passant"
                  placeholder="e.g., e3, f6, or -"
                  maxlength="2"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Game Moves -->
        <div class="game-moves-section">
          <h2>Game Moves</h2>
          <div class="game-moves-content">
            <div class="game-moves-controls">
              <button id="prev-move" disabled>← Previous</button>
              <button id="next-move" disabled>Next →</button>
            </div>
            <div id="game-moves" class="moves-panel"></div>
            <div class="game-moves-actions">
              <button id="load-mate-in-4" class="mate-button">
                Load Mate-in-4 Position
              </button>
              <button id="load-mate-in-1-black" class="mate-button">
                Load Mate-in-1 Prior Position
              </button>
              <button id="load-mate-in-1-white" class="mate-button">
                Load Mate-in-1 Next Position
              </button>
            </div>
          </div>
        </div>

        <!-- Analysis Controls -->
        <div class="controls-section">
          <h2>Controls</h2>
          <div class="control-group">
            <label for="max-depth">Max Depth:</label>
            <input type="number" id="max-depth" min="1" max="50" value="20" />
          </div>
          <div class="control-group">
            <label for="white-moves">White Moves:</label>
            <input type="number" id="white-moves" min="1" max="20" value="5" />
          </div>
          <div class="control-group">
            <label for="responder-moves">Responder Moves:</label>
            <input
              type="number"
              id="responder-moves"
              min="1"
              max="20"
              value="5"
            />
          </div>
          <div class="control-group">
            <label for="threads">Threads:</label>
            <input type="number" id="threads" min="1" max="8" value="1" />
          </div>

          <div class="analysis-controls">
            <button id="start-analysis">Start</button>
            <button id="stop-analysis" disabled>Stop</button>
            <button
              id="recover-from-crash"
              style="display: inline-block"
              title="Reset UI state after Stockfish crash. This only resets the interface - Stockfish may still be running in the background."
            >
              Recover
            </button>
          </div>

          <div class="format-controls">
            <div class="control-group">
              <label>Algebraic:</label>
              <div class="radio-row">
                <label class="radio-label">
                  <input
                    type="radio"
                    name="notation-format"
                    value="algebraic-short"
                    checked
                  />
                  <span>Short</span>
                </label>
                <label class="radio-label">
                  <input
                    type="radio"
                    name="notation-format"
                    value="algebraic-long"
                  />
                  <span>Long</span>
                </label>
              </div>
            </div>
            <div class="control-group">
              <label>Notation:</label>
              <div class="radio-row">
                <label class="radio-label">
                  <input
                    type="radio"
                    name="piece-format"
                    value="symbols"
                    checked
                  />
                  <span>Symbols</span>
                </label>
                <label class="radio-label">
                  <input type="radio" name="piece-format" value="letters" />
                  <span>Letters</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Engine Moves -->
        <div class="results-section">
          <h2>Engine Moves</h2>
          <div class="status">
            <div class="status-title">Stockfish</div>
            <p id="engine-status">Ready</p>
          </div>
            <div class="pv-ticker" id="engine-pv-ticker"></div>
          <div id="analysis-results" class="results-panel"></div>
        </div>
      </div>
    </div>

    <!-- Stockfish loading script -->
    <script>
      // Load Stockfish WebAssembly module
      window.exports = {};
      window.Stockfish = window.exports.Stockfish;
    </script>
    <script src="/dist/stockfish.js"></script>

    <!-- Application script -->
    <script type="module">
      import { initializeApp } from "/dist/line/main.js";

      // Initialize the application when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        try {
          initializeApp();
          console.log("Best Chess Line Discovery App initialized successfully");
        } catch (error) {
          console.error("Failed to initialize application:", error);
        }
      });
    </script>
  </body>
</html>
