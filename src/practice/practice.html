<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chess Practice</title>
    <link rel="stylesheet" href="/src/practice/practice.css" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="practice-container">
      <div class="practice-header">
        <h1 class="practice-title">Chess Practice</h1>
        <p class="practice-subtitle">
          Learn and practice chess openings with guided training
        </p>
      </div>

      <div class="practice-content">
        <div class="practice-board-section">
          <div class="practice-board">
            <div class="practice-board-grid" id="practice-board-grid">
              <!-- Board squares will be generated by JavaScript -->
            </div>
            <div class="practice-file-labels">
              <span>a</span>
              <span>b</span>
              <span>c</span>
              <span>d</span>
              <span>e</span>
              <span>f</span>
              <span>g</span>
              <span>h</span>
            </div>
            <div class="practice-rank-labels">
              <span>8</span>
              <span>7</span>
              <span>6</span>
              <span>5</span>
              <span>4</span>
              <span>3</span>
              <span>2</span>
              <span>1</span>
            </div>

            <!-- Start Practice Overlay -->
            <div class="practice-start-overlay" id="practice-start-overlay">
              <div class="practice-start-content">
                <h2 class="practice-start-title">Ready to Practice?</h2>
                <p class="practice-start-subtitle">
                  Load your opening lines and click to begin training
                </p>
                <button
                  class="practice-button primary practice-start-btn"
                  id="practice-start-overlay-btn"
                >
                  Reload
                </button>
              </div>
            </div>
          </div>

          <div class="practice-controls">
            <button class="practice-button primary" id="practice-start-btn">
              Reload
            </button>
            <button class="practice-button secondary" id="practice-reset-btn">
              Reset
            </button>
            <button class="practice-button warning" id="practice-hint-btn">
              Hint
            </button>
            <button class="practice-button success" id="practice-next-btn">
              Next Line
            </button>
            <button
              class="practice-button"
              id="practice-confetti-btn"
              style="
                background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
                color: white;
              "
            >
              Test Confetti
            </button>
            <button
              class="practice-button"
              id="practice-clear-selections-btn"
              style="
                background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
                color: white;
              "
            >
              Clear Selections
            </button>
            <button
              class="practice-button"
              id="practice-clear-arrows-btn"
              style="
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
                color: white;
              "
            >
              Clear Arrows
            </button>
            <button
              class="practice-button"
              id="practice-go-back-btn"
              style="
                background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
                color: white;
              "
            >
              Go Back
            </button>
            <button
              class="practice-button"
              id="practice-go-back-random-btn"
              style="
                background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
                color: white;
              "
            >
              Go Back (Random)
            </button>
            <button
              class="practice-button"
              id="practice-pin-position-btn"
              style="
                background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);
                color: white;
              "
            >
              Pin Position
            </button>
            <button
              class="practice-button"
              id="practice-restart-pinned-btn"
              style="
                background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
                color: white;
              "
            >
              Restart from Pinned
            </button>
          </div>

          <!-- AI Coach (Main Column) -->
          <div class="practice-ai-main" id="practice-ai-coach">
            <div class="practice-ai-header">
              <div class="left">
                <h3
                  class="practice-panel-title"
                  style="
                    border-bottom: 0;
                    padding-bottom: 0;
                    margin-bottom: 4px;
                  "
                >
                  <span class="practice-ai-icon" aria-hidden="true">ðŸ¤–</span>
                  AI Coach
                </h3>
                <div class="practice-ai-subtitle">From Blunder to Wunder</div>
              </div>
              <div class="right">
                <div class="practice-ai-controls">
                  <div class="left">
                    <div class="practice-input-group" style="min-width: 220px">
                      <label class="practice-label" for="practice-ai-api-key"
                        >API Key (optional)</label
                      >
                      <input
                        type="password"
                        class="practice-input"
                        id="practice-ai-api-key"
                        placeholder="sk-..."
                      />
                    </div>
                    <div class="practice-input-group" style="min-width: 140px">
                      <label class="practice-label" for="practice-ai-level"
                        >Level</label
                      >
                      <select class="practice-select" id="practice-ai-level">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate">Intermediate</option>
                        <option value="advanced">Advanced</option>
                        <option value="expert">Expert</option>
                        <option value="gm">GM</option>
                      </select>
                    </div>
                    <div class="practice-input-group" style="min-width: 160px">
                      <label class="practice-label" for="practice-ai-model"
                        >Model</label
                      >
                      <input
                        type="text"
                        class="practice-input"
                        id="practice-ai-model"
                        value="gpt-4o-mini"
                      />
                    </div>
                  </div>
                  <div class="right">
                    <button
                      class="practice-button practice-ai-ask-button"
                      id="practice-ai-ask-btn"
                      aria-busy="false"
                    >
                      Analyze Position
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Optional quick chip row removed to encourage single structured analysis -->

            <div class="practice-input-group">
              <label class="practice-label" for="practice-ai-question"
                >Follow-up (optional)</label
              >
              <textarea
                class="practice-input practice-textarea"
                id="practice-ai-question"
                placeholder="Ask a brief follow-up; the main analysis will still be structured."
              ></textarea>
            </div>

            <div class="ai-summary" id="practice-ai-summary" aria-live="polite">
              <em>Ask AI to populate a concise summary hereâ€¦</em>
            </div>

            <div class="ai-sections" id="practice-ai-sections">
              <!-- Filled dynamically with section cards -->
            </div>

            <!-- Raw answer fallback (hidden from view but kept for accessibility/inspection) -->
            <div class="visually-hidden" id="practice-ai-answer"></div>
          </div>
        </div>

        <div class="practice-sidebar">
          <div class="practice-panel">
            <h3 class="practice-panel-title">Game Status</h3>
            <div class="practice-status">
              <div
                class="practice-status-indicator"
                id="practice-status-indicator"
              ></div>
              <span class="practice-status-text" id="practice-status-text"
                >Ready to start</span
              >
            </div>

            <div class="practice-stats-grid">
              <div class="practice-stat">
                <div class="practice-stat-value" id="practice-correct-moves">
                  0
                </div>
                <div class="practice-stat-label">Correct Moves</div>
              </div>
              <div class="practice-stat">
                <div class="practice-stat-value" id="practice-total-moves">
                  0
                </div>
                <div class="practice-stat-label">Total Moves</div>
              </div>
              <div class="practice-stat">
                <div class="practice-stat-value" id="practice-accuracy">0%</div>
                <div class="practice-stat-label">Accuracy</div>
              </div>
              <div class="practice-stat">
                <div class="practice-stat-value" id="practice-current-line">
                  1
                </div>
                <div class="practice-stat-label">Current Line</div>
              </div>
            </div>
          </div>

          <div class="practice-panel">
            <h3 class="practice-panel-title">Depth Control</h3>
            <div class="practice-depth-control">
              <div class="practice-input-group">
                <label class="practice-label" for="practice-max-depth"
                  >Max Human Moves per Line</label
                >
                <div class="practice-slider-container">
                  <input
                    type="range"
                    class="practice-slider"
                    id="practice-max-depth"
                    min="1"
                    max="15"
                    value="1"
                  />
                  <span class="practice-slider-value" id="practice-slider-value"
                    >1</span
                  >
                </div>
              </div>
              <div class="practice-depth-info">
                <span class="practice-depth-label">Human Moves Made:</span>
                <span class="practice-depth-value" id="practice-current-depth"
                  >0</span
                >
              </div>
            </div>
          </div>

          <div class="practice-panel">
            <h3 class="practice-panel-title">Move History</h3>
            <div class="practice-moves" id="practice-moves">
              <!-- Move history will be populated by JavaScript -->
            </div>
          </div>

          <div class="practice-panel">
            <h3 class="practice-panel-title">
              Top Next Best Moves (if available)
            </h3>
            <div class="practice-top-moves" id="practice-top-moves">
              <em>No engine metadata loaded</em>
            </div>
          </div>

          <div class="practice-panel">
            <h3 class="practice-panel-title">Configuration</h3>
            <div class="practice-config">
              <div class="practice-input-group">
                <label class="practice-label" for="practice-starting-fen"
                  >Starting Position (FEN)</label
                >
                <input
                  type="text"
                  class="practice-input"
                  id="practice-starting-fen"
                  value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"
                />
              </div>

              <div class="practice-input-group">
                <label class="practice-label" for="practice-move-selection"
                  >Move Selection</label
                >
                <select class="practice-select" id="practice-move-selection">
                  <option value="random">Random</option>
                  <option value="serial">Serial</option>
                  <option value="adaptive">
                    Adaptive (Focus on weak positions)
                  </option>
                </select>
              </div>

              <div class="practice-input-group">
                <label class="practice-label" for="practice-notation-toggle"
                  >Notation</label
                >
                <select class="practice-select" id="practice-notation-toggle">
                  <option value="english">English (KQRBNP)</option>
                  <option value="unicode">Figures (â™”â™•â™–â™—â™˜â™™)</option>
                </select>
              </div>

              <div class="practice-input-group">
                <label class="practice-label" for="practice-opening-lines"
                  >Opening Lines (Text Format)</label
                >
                <textarea
                  class="practice-input practice-textarea"
                  id="practice-opening-lines"
                  placeholder="Enter opening lines in text format, one game per line..."
                >
1. g1f3 // {"lineId":"line_0","isMate":false,"isStalemate":false,"isTransposition":false,"transpositionTarget":"","replies":[{"move":"e7e6","score":8},{"move":"c7c5","score":15},{"move":"g8f6","score":17},{"move":"d7d5","score":20},{"move":"b8c6","score":27}],"alts":[{"move":"d2d4","score":13},{"move":"d2d4","score":13},{"move":"d2d4","score":13},{"move":"g1f3","score":8},{"move":"e2e3","score":8}]}
1. g1f3  e7e6 2. g2g3 // {"lineId":"line_1","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[{"move":"d7d5","score":4},{"move":"g8f6","score":4},{"move":"f8e7","score":4},{"move":"b8c6","score":17},{"move":"h7h6","score":17}],"alts":[{"move":"d2d4","score":13},{"move":"c2c4","score":13},{"move":"e2e3","score":8},{"move":"a2a3","score":8},{"move":"e2e4","score":4}]}
1. g1f3  e7e6 2. g2g3 // {"lineId":"line_2","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[{"move":"d7d5","score":4},{"move":"g8f6","score":4},{"move":"f8e7","score":8},{"move":"c7c5","score":13},{"move":"b8c6","score":13}],"alts":[{"move":"c2c4","score":13},{"move":"d2d4","score":13},{"move":"e2e4","score":8},{"move":"e2e3","score":8},{"move":"a2a3","score":4}]}
1. g1f3  e7e6 2. g2g3  d7d5 3. d2d4 // {"lineId":"line_3","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[{"move":"c7c5","score":0},{"move":"g8f6","score":4},{"move":"f8e7","score":4},{"move":"f8d6","score":13},{"move":"h7h6","score":13}],"alts":[{"move":"f1g2","score":4},{"move":"d2d4","score":4},{"move":"e2e3","score":0},{"move":"c2c4","score":0},{"move":"c2c3","score":-1}]}
1. g1f3  e7e6 2. g2g3  g8f6 3. f1g2 // {"lineId":"line_4","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[{"move":"b8c6","score":22},{"move":"h7h6","score":22},{"move":"c7c5","score":22},{"move":"d7d5","score":0},{"move":"f8e7","score":0}],"alts":[{"move":"f1g2","score":8},{"move":"c2c4","score":6},{"move":"d2d4","score":4},{"move":"e2e3","score":0},{"move":"d2d3","score":-4}]}
1. g1f3  e7e6 2. g2g3  f8e7 3. d2d4 // {"lineId":"line_5","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[{"move":"d7d5","score":0},{"move":"g8f6","score":0},{"move":"c7c5","score":20},{"move":"d7d6","score":22},{"move":"h7h5","score":34}],"alts":[{"move":"e2e4","score":4},{"move":"f1g2","score":4},{"move":"d2d4","score":0},{"move":"c2c4","score":0},{"move":"e2e3","score":0}]}
1. g1f3  e7e6 2. g2g3  d7d5 3. c2c3 // {"lineId":"line_6","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[{"move":"f8d6","score":-4},{"move":"c7c5","score":-4},{"move":"g8f6","score":0},{"move":"b8d7","score":0},{"move":"h7h6","score":0}],"alts":[{"move":"c2c3","score":0},{"move":"d2d4","score":0},{"move":"f1g2","score":0},{"move":"e2e3","score":0},{"move":"d2d3","score":-8}]}
1. g1f3  e7e6 2. g2g3  g8f6 3. f1g2 // {"lineId":"line_7","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[{"move":"d7d5","score":0},{"move":"f8e7","score":0},{"move":"c7c5","score":13},{"move":"b8c6","score":13},{"move":"h7h6","score":17}],"alts":[{"move":"c2c4","score":0},{"move":"f1g2","score":0},{"move":"e2e3","score":0},{"move":"d2d4","score":0},{"move":"c2c3","score":0}]}
1. g1f3  e7e6 2. g2g3  f8e7 3. d2d4 // {"lineId":"line_8","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[{"move":"d7d5","score":0},{"move":"g8f6","score":4},{"move":"c7c5","score":17},{"move":"d7d6","score":25},{"move":"b7b6","score":31}],"alts":[{"move":"e2e4","score":4},{"move":"f1g2","score":4},{"move":"c2c4","score":1},{"move":"d2d4","score":1},{"move":"c2c3","score":0}]}
1. g1f3  e7e6 2. g2g3  d7d5 3. d2d4  c7c5 4. b1c3 // {"lineId":"line_9","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"f1g2","score":8},{"move":"e2e3","score":4},{"move":"c2c3","score":1},{"move":"d4c5","score":0},{"move":"c2c4","score":-4}]}
1. g1f3  e7e6 2. g2g3  d7d5 3. d2d4  g8f6 4. c2c3 // {"lineId":"line_10","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"f1g2","score":4},{"move":"c2c4","score":0},{"move":"c2c3","score":0},{"move":"e2e3","score":-4},{"move":"c1f4","score":-4}]}
1. g1f3  e7e6 2. g2g3  d7d5 3. d2d4  f8e7 4. c2c3 // {"lineId":"line_11","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"c2c4","score":0},{"move":"f1g2","score":0},{"move":"c1f4","score":0},{"move":"a2a3","score":0},{"move":"c2c3","score":0}]}
1. g1f3  e7e6 2. g2g3  g8f6 3. f1g2  b8c6 4. d2d4 // {"lineId":"line_12","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"e1g1","score":17},{"move":"c2c4","score":17},{"move":"a2a3","score":17},{"move":"d2d4","score":17},{"move":"b1c3","score":4}]}
1. g1f3  e7e6 2. g2g3  g8f6 3. f1g2  h7h6 4. e1g1 // {"lineId":"line_13","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"c2c4","score":24},{"move":"d2d4","score":22},{"move":"e1g1","score":22},{"move":"b2b3","score":22},{"move":"e2e3","score":22}]}
1. g1f3  e7e6 2. g2g3  g8f6 3. f1g2  b8c6 4. e1g1 // {"lineId":"line_14","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"e1g1","score":24},{"move":"d2d4","score":22},{"move":"c2c4","score":17},{"move":"a2a3","score":17},{"move":"b1c3","score":4}]}
1. g1f3  e7e6 2. g2g3  f8e7 3. d2d4  d7d5 4. e2e3 // {"lineId":"line_15","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"c2c4","score":4},{"move":"f1g2","score":2},{"move":"b1d2","score":0},{"move":"a2a3","score":0},{"move":"c2c3","score":-3}]}
1. g1f3  e7e6 2. g2g3  f8e7 3. d2d4  d7d5 4. c2c3 // {"lineId":"line_16","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"c2c4","score":1},{"move":"f1g2","score":0},{"move":"a2a3","score":0},{"move":"c2c3","score":0},{"move":"c1f4","score":0}]}
1. g1f3  e7e6 2. g2g3  f8e7 3. d2d4  g8f6 4. b1c3 // {"lineId":"line_17","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"f1g2","score":4},{"move":"c2c4","score":0},{"move":"a2a3","score":0},{"move":"e2e3","score":0},{"move":"b1d2","score":-4}]}
1. g1f3  e7e6 2. g2g3  d7d5 3. c2c3  f8d6 4. e2e3 // {"lineId":"line_18","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"d2d4","score":4},{"move":"d2d3","score":0},{"move":"f1g2","score":0},{"move":"b1a3","score":-8},{"move":"c3c4","score":-15}]}
1. g1f3  e7e6 2. g2g3  d7d5 3. c2c3  c7c5 4. d1a4 // {"lineId":"line_19","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"f1g2","score":0},{"move":"d2d4","score":0},{"move":"d2d3","score":-4},{"move":"f1h3","score":-4},{"move":"b1a3","score":-17}]}
1. g1f3  e7e6 2. g2g3  d7d5 3. c2c3  g8f6 4. e2e3 // {"lineId":"line_20","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"f1g2","score":0},{"move":"d2d4","score":0},{"move":"d2d3","score":-4},{"move":"d1c2","score":-4},{"move":"b1a3","score":-10}]}
1. g1f3  e7e6 2. g2g3  g8f6 3. f1g2  d7d5 4. d2d3 // {"lineId":"line_21","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"d2d4","score":4},{"move":"e1g1","score":0},{"move":"c2c4","score":0},{"move":"e2e3","score":0},{"move":"d2d3","score":-5}]}
1. g1f3  e7e6 2. g2g3  g8f6 3. f1g2  f8e7 4. c2c3 // {"lineId":"line_22","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"e1g1","score":8},{"move":"c2c4","score":4},{"move":"d2d4","score":4},{"move":"e2e3","score":4},{"move":"c2c3","score":0}]}
1. g1f3  e7e6 2. g2g3  g8f6 3. f1g2  c7c5 4. d2d3 // {"lineId":"line_23","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"c2c4","score":27},{"move":"e1g1","score":8},{"move":"e2e3","score":4},{"move":"c2c3","score":0},{"move":"b2b3","score":0}]}
1. g1f3  e7e6 2. g2g3  f8e7 3. d2d4  d7d5 4. c2c3 // {"lineId":"line_24","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"a2a3","score":4},{"move":"c2c4","score":0},{"move":"f1g2","score":0},{"move":"c2c3","score":0},{"move":"c1f4","score":-2}]}
1. g1f3  e7e6 2. g2g3  f8e7 3. d2d4  d7d5 4. c2c3 // {"lineId":"line_25","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"c2c4","score":4},{"move":"b1d2","score":0},{"move":"f1g2","score":0},{"move":"c1f4","score":0},{"move":"a2a3","score":0}]}
1. g1f3  e7e6 2. g2g3  f8e7 3. d2d4  d7d5 4. c2c3 // {"lineId":"line_26","isMate":false,"isStalemate":false,"isTransposition":false,"replies":[],"alts":[{"move":"a2a3","score":7},{"move":"c1f4","score":0},{"move":"c2c4","score":0},{"move":"f1g2","score":0},{"move":"c2c3","score":-4}]}
                  </textarea
                >
                <button
                  class="practice-button secondary"
                  id="practice-load-lines-btn"
                  style="
                    background: linear-gradient(
                      135deg,
                      #3498db 0%,
                      #2980b9 100%
                    );
                    color: white;
                    margin-top: 8px;
                  "
                >
                  Load from practice-lines.ts
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Application script -->
    <script type="module">
      import { initializePractice } from "/dist/practice/practice.js";

      // Initialize the application when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        try {
          initializePractice();
          console.log("Chess Practice App initialized successfully");
        } catch (error) {
          console.error("Failed to initialize practice application:", error);
        }
      });
    </script>
  </body>
</html>
